@model prjiSpanFinal.ViewModels.Delivery.CDeliveryCheckoutViewModel
@using prjiSpanFinal.ViewModels.Delivery
@{
    ViewData["Title"] = "Checkout";
    List<int> sellerIDList = new List<int>();
    List<string> sellerAccList = new List<string>();
    foreach(var i in Model.sellerShipperPayments)
    {
        if (sellerIDList.Contains(i.seller.MemberId))
        {
            continue;
        }
        else
        {
            sellerIDList.Add(i.seller.MemberId);
            sellerAccList.Add(i.seller.MemberAcc);
        }
    }
}

@section Styles{
    <link href="~/css/Delivery/ProgressBar.css" rel="stylesheet" />
    <link href="~/css/Delivery/DeliveryCheckout.css" rel="stylesheet"/>
}

@await Component.InvokeAsync("DeliveryProgressBar", new { checkoutPage = 1 })
<div class="btn-group mb-3" role="group" aria-label="Basic radio toggle button group" id="choseStore">
    <div class="sellerIDIndex d-none">0</div>
    <div class="sellerIDCount d-none">@sellerIDList.Count</div>
    <input type="radio" class="sellerID btn-check" name="btnradio" id="@sellerIDList[0]" autocomplete="off" checked>
    <label class="sellers btn btn-outline-warning" for="@sellerIDList[0]">@sellerAccList[0]</label>
    @{
        for (int i = 1; i < sellerAccList.Count; i++)
        {
            <input type="radio" class="sellerID btn-check" name="btnradio" id="@sellerIDList[i]" autocomplete="off">
            <label class="sellers btn btn-outline-warning" for="@sellerIDList[i]">@sellerAccList[i]</label>
        }
    }
</div>
<div class="row">
    <div class="col-9">
        <div class="checkoutFormVC">
            @await Component.InvokeAsync("DeliveryFillCheckoutForm", new { sellerIDIndex = 0}) 
        </div>
        <div class="text-center">
            <button class="btn btn-warning d-none" id="previousStore">回上一筆</button>
            <button class="btn btn-primary" id="nextStore">確認並前往下一筆</button>
        </div>
    </div>
    <div class="col-3">
        <div class="showCalTotalPriceVC">
            @await Component.InvokeAsync("CalTotalPrice", new { id = 2 })
        </div>
    </div>
</div>

@section Scripts{
    <script>
        $(function () {
                $(".checkoutFormVC").load("@Url.Content("~/Delivery/CheckoutForm")" + `?sellerIDIndex=0`);
        });

        function changePage(NextOrPrevOrIndex) {
            const sellerCount = Number($(".sellerIDCount").html());
            const sellerIDIndex = Number($(".sellerIDIndex").html());
            let nextSellerIDIndex;
            if (NextOrPrevOrIndex == "Next") {
                nextSellerIDIndex = sellerIDIndex + 1;
            }
            else if (NextOrPrevOrIndex == "Prev") {
                nextSellerIDIndex = sellerIDIndex - 1;
            }
            else {
                nextSellerIDIndex = NextOrPrevOrIndex;
            }

            const _url = "@Url.Content("~/Delivery/CheckoutForm")" + `?sellerIDIndex=${nextSellerIDIndex}`;
            $(".checkoutFormVC").load(_url);
            $(".sellerIDIndex").html(nextSellerIDIndex);
            if (nextSellerIDIndex >= sellerCount - 1) {
                $("#nextStore").removeClass("d-none").addClass("d-none");
            }
            else {
                $("#nextStore").removeClass("d-none");
            }
            if (nextSellerIDIndex <= 0) {
                $("#previousStore").removeClass("d-none").addClass("d-none");
            }
            else {
                $("#previousStore").removeClass("d-none");
            }
            $("#choseStore").find(".sellerID").eq(nextSellerIDIndex).prop("checked", true);
        };
        $("#nextStore").click(function () {
            changePage("Next");
        });
        $("#previousStore").click(function () {
            changePage("Prev");
        })
        $(".sellers").click(function () {
            changePage($(this).index("label"))
        });

    </script>
    @*<script src="~/js/Delivery/DeliveryFillCheckoutForm.js"></script>*@
    <script src="~/js/Delivery/DeliveryCheckout.js"></script>
    <script src="~/js/Delivery/ProgressBar.js"></script>
    
}