@using prjiSpanFinal.ViewModels
@model prjiSpanFinal.ViewModels.CItemIndexViewModel
@{
    ViewData["Title"] = "Index";
}

<link rel="stylesheet" href="~/css/ItemIndex.css" />
<link rel="stylesheet" href="~/css/bootstrap5.min.css" />

<div class="container">
    <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="#">蝦到爆商城</a></li>
            <li class="breadcrumb-item"><a href="#">@Model.CBigType.BigTypeName</a></li>
            <li class="breadcrumb-item active" aria-current="page">@Model.CSmallType.SmallTypeName</li>
        </ol>
    </nav>
    <div class="product">
        <div class="productPhoto">
            <div class="bigPhoto">
                @{
                    string base64 = Convert.ToBase64String(Model.CProductPics[0].Picture);
                    string imgSrc = $"data:image/gif;base64,{base64}";
                    <img src="@imgSrc" />
                }
            </div>
            <div class="smallPhoto d-flex justify-content-center">
                @foreach (CProductPicViewModel i in Model.CProductPics)
                {
                    string base65 = Convert.ToBase64String(i.Picture);
                    string imgSrc1 = $"data:image/gif;base64,{base65}";
                    <div><img src="@imgSrc1" /></div>
                }
            </div>
        </div>
        <div class="itemInfo">
            <h4>@Model.CProducts.ProductName</h4>
            <div class="d-flex justify-content-start align-items-center">
                @{
                    if (Model.CommentCount == 0)
                    {
                        <div class="ms-3">尚未有評價</div>
                        <div class="ms-3">|</div>
                        <div class="ms-3">已售出: @Model.SellCount</div>
                    }
                    else
                    {
                        int starCount = Convert.ToInt32(Math.Round(Model.CommentAvgScore, 0, MidpointRounding.AwayFromZero));
                        for (int i = 1; i <= 5; i++)
                        {
                            if (i <= starCount)
                            {
                                <div class="starBox"><img src="~/img/YellowStar.png" /></div>
                            }
                            else
                            {
                                <div class="starBox"><img src="~/img/WhiteStar.png" /></div>
                            }
                        }
                        <div class="ms-3">
                            @Model.CommentAvgScore.ToString("0.0")
                        </div>
                        <div class="ms-1">
                            <span>(</span><a href="#">@Model.CommentCount</a><span>)</span>
                        </div>
                        <div class="ms-3">|</div>
                        <div class="ms-3">已售出: @Model.SellCount</div>
                    }
                }
            </div>
            <div class="itemDetails">
                <form method="post" action="/Delivery/Checkout">
                    <div class="d-flex justify-content-start align-items-center mb-1">
                        <div class="itemKey">直購價:</div>
                        @{
                            List<decimal> priceList = new List<decimal>();
                            string price = "";
                            foreach (var i in Model.CProductDetails)
                            {
                                priceList.Add(i.UnitPrice);
                            }
                            decimal maxPrice = priceList.Max();
                            decimal minPrice = priceList.Min();
                            if (maxPrice == minPrice)
                            {
                                price = $"${minPrice.ToString("0")}";
                            }
                            else
                            {
                                price = $"${minPrice.ToString("0")} - ${maxPrice.ToString("0")}";
                            }
                            <div class="itemPrice ms-3 fs-3 fw-bold text-danger">@price</div>
                        }
                    </div>
                    <div class="d-flex justify-content-between align-self-start mb-1">
                        <input type="hidden" name="purchaseProduct" value="@Model.CProducts.ProductId" />
                        @{
                            if (Model.CProductDetails[0].Style != "樣式1")
                            {
                                <div class="itemKey">規格:</div>
                                <div class="itemStyleContent d-flex flex-wrap ms-3">
                                    @{
                                        int count = 0;
                                        foreach (var i in Model.CProductDetails)
                                        {
                                            string price1 = $"${i.UnitPrice.ToString("0")}";
                                            string qty = i.Quantity.ToString();
                                            count++;
                                            string id = $"style{count}";
                                            <div class="ms-1 mb-1">
                                                @if (i.Quantity <= 0)
                                                {
                                                    <input type="radio" class="btn-check" name="purchaseStyle" id="@id" autocomplete="off" value="@i.ProductDetailId" disabled>
                                                    <label class="purchaseStyle btn btn-outline-secondary rounded-1" for="@id">@i.Style</label>
                                                }
                                                else
                                                {
                                                    <input type="radio" class="btn-check" name="purchaseStyle" id="@id" autocomplete="off" value="@i.ProductDetailId">
                                                    <label class="purchaseStyle btn btn-outline-secondary btn-sm rounded-1" for="@id">@i.Style</label>
                                                }

                                                <div class="d-none price">@price1</div>
                                                <div class="d-none qty">@qty</div>
                                                @{
                                                    string base66 = Convert.ToBase64String(i.Pic);
                                                    string imgSrc1 = $"data:image/gif;base64,{base66}";
                                                }
                                                <img class="d-none itemStyleImg" src="@imgSrc1" />
                                            </div>
                                        }
                                    }
                                </div>
                            }
                            else
                            {
                                <input type="hidden" name="purchaseStyle" value="@Model.CProductDetails[0].ProductDetailId" checked />
                            }
                        }
                    </div>
                    <div class="d-flex justify-content-start align-items-center mb-3">
                        <label for="itemCount" class="itemKey">數量:</label>
                        <input type="number" value="1" name="purchaseCount" min="1" class="ms-3" id="itemCount" />
                        <div class="itemRemainingQty ms-3">還剩件數</div>
                    </div>
                    <div class="d-flex justify-content-start align-items-center ps-5">
                        <input type="submit" value="加入購物車" formaction="/Delivery/CartList" class="btn btn-warning me-3 ms-4" />
                        <input type="submit" value="直接購買" class="btn btn-success" />
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="productDescription">

    </div>


</div>
<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
<script src="~/js/ItemIndex.js"></script>