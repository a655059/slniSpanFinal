@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@

@model prjiSpanFinal.ViewModels.Delivery.CInfoForCalTotalPriceViewModel



<div class="border rounded-2 p-2 w-100" style="position:relative">

    @if (Model.isCheckoutPage == 1)
    {

    }
    else
    {
        <div class="d-flex justify-content-between mb-3 fw-bold">
            <div>全站折扣</div>
            <button class="selectCoupon border-0 bg-transparent" @*data-bs-toggle="modal" data-bs-target="#exampleModal"*@>選擇折價券<span class="ms-2">></span></button>
        </div>
    }
    <div class="d-flex justify-content-between mb-3">
        <div>小計</div>
        <div>$<span id="smallPrice"></span></div>
    </div>
    <div class="divDiscount d-flex justify-content-between mb-3 d-none">
        <div>折扣碼:<span class="selectedCouponID text-danger" id="couponID1">沒有優惠</span></div>
        <div class="d-flex justify-content-end align-items-center">
            <div class="text-danger">-$<span id="discountPrice"></span></div>
            <button class="removeCoupon bg-transparent border-0 d-none"><i class="fa-solid fa-xmark text-primary"></i></button>
        </div>
    </div>
    @if (Model.isCheckoutPage == 1)
    {

    }
    else
    {
        <div class="calFeePrice d-flex justify-content-between mb-3 d-none">
            <div class="selectedCouponID">運費:</div>
            <div class="d-flex justify-content-end align-items-center">
                <div class="text-danger">+$<span class="finalShipperFee" id="finalShipperFee">0</span></div>
            </div>
        </div>
        <div class="calPaymentFeePrice d-flex justify-content-between mb-3 d-none">
            <div class="selectedCouponID">手續費:</div>
            <div class="d-flex justify-content-end align-items-center">
                <div class="text-danger">+$<span class="finalPaymentFee" id="finalPaymentFee">0</span></div>
            </div>
        </div>
    }
    <div class="d-flex justify-content-between mb-3 border-top">
        <div>總計</div>
        <div>$<span id="totalPrice"></span></div>
    </div>
    @if (Model.isCheckoutPage == 1)
    {
        <button class="goCheckout btn btn-warning w-100" id="goCheckout">去結帳</button>
    }
    else
    {
        <div class="d-flex justify-content-around">
            <button class="btn btn-warning d-none" id="previousStore">回上一筆</button>
            <button class="btn btn-primary" id="nextStore">確認並前往下一筆</button>
        </div>
    }
    @{
        if (Model.isCheckoutPage != 1)
        {
            <div class="couponModal rounded-2 border border-2 border-dark bg-white" style="width:400px;position:absolute;right:0px;display:none;box-shadow:5px 5px 20px lightgray">
                <div class="border-bottom border-2 p-2">
                    <h3>選擇折價券</h3>
                </div>
                <div class="border-bottom border-2 p-2">
                    @{
                        int couponCount = 0;
                        foreach (var i in Model.buyerCoupons)
                        {
                            string idName = "option" + couponCount;
                            couponCount++;
                            <div class="text-center">
                                <input type="radio" class="btn-check" name="options" id="@idName" autocomplete="off">
                                <label class="coupon btn btn-outline-warning text-black" for="@idName">
                                    @{
                                        if (i.IsFreeDelivery)
                                        {
                                            if (i.MinimumOrder > 0)
                                            {
                                                <div>滿<span>@i.MinimumOrder</span>即享免運費</div>
                                            }
                                            else
                                            {
                                                <div>不限金額皆享免運費</div>
                                            }
                                        }
                                        else
                                        {
                                            string discount = (i.Discount * 10).ToString("0.0");
                                            if (discount.Split('.')[1] == "0")
                                            {
                                                discount = discount.Split('.')[0];
                                            }
                                            if (i.MinimumOrder > 0)
                                            {

                                                <div>滿$<span>@i.MinimumOrder</span>即享<span>@discount</span>折優惠</div>
                                            }
                                            else
                                            {
                                                <div>不限金額皆享<span>@discount</span>折優惠</div>
                                            }
                                        }
                                    }
                                    <div>折扣碼:<span>@i.CouponCode</span></div>
                                    @{
                                        string period = i.StartDate.ToString("yyyy/MM/dd") + " ~ " + i.ExpiredDate.ToString("yyyy/MM/dd");
                                    }
                                    <div>活動期間:<span>@period</span></div>
                                </label>
                            </div>
                        }
                    }
                </div>
                <div class="d-flex justify-content-between p-2">
                    <div>
                        <div class="discount">已選折扣<span class="text-danger mx-3">0</span></div>
                    </div>
                    <div>
                        <button type="button" class="cancel btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="chose btn btn-warning" data-bs-dismiss="modal">確定選擇折價券</button>
                    </div>
                </div>
            </div>

        }
    }
</div>



    @*<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" z-index="10">
            <div class="modal-dialog  modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header border-bottom-0">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">選擇折價券</h1>
                        <button type="button" class="cancel btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        @{
                            int couponCount = 0;
                            foreach (var i in Model.buyerCoupons)
                            {
                                string idName = "option" + couponCount;
                                couponCount++;
                                <div class="text-center">
                                    <input type="radio" class="btn-check" name="options" id="@idName" autocomplete="off">
                                    <label class="coupon btn btn-outline-warning text-black" for="@idName">
                                        @{
                                            if (i.IsFreeDelivery)
                                            {
                                                if (i.MinimumOrder > 0)
                                                {
                                                    <div>滿<span>@i.MinimumOrder</span>即享免運費</div>
                                                }
                                                else
                                                {
                                                    <div>不限金額皆享免運費</div>
                                                }
                                            }
                                            else
                                            {
                                                string discount = (i.Discount * 10).ToString("0.0");
                                                if (discount.Split('.')[1] == "0")
                                                {
                                                    discount = discount.Split('.')[0];
                                                }
                                                if (i.MinimumOrder > 0)
                                                {

                                                    <div>滿$<span>@i.MinimumOrder</span>即享<span>@discount</span>折優惠</div>
                                                }
                                                else
                                                {
                                                    <div>不限金額皆享<span>@discount</span>折優惠</div>
                                                }
                                            }
                                        }
                                        <div>折扣碼:<span>@i.CouponCode</span></div>
                                        @{
                                            string period = i.StartDate.ToString("yyyy/MM/dd") + " ~ " + i.ExpiredDate.ToString("yyyy/MM/dd");
                                        }
                                        <div>活動期間:<span>@period</span></div>
                                    </label>
                                </div>
                            }
                        }
                    </div>
                    <div class="modal-footer justify-content-between">
                        <div>
                            <div class="discount">已選折扣<span class="text-danger mx-3">0</span></div>
                        </div>
                        <div>
                            <button type="button" class="cancel btn btn-secondary" data-bs-dismiss="modal">取消</button>
                            <button type="button" class="chose btn btn-warning" data-bs-dismiss="modal">確定選擇折價券</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>*@

    @*<script src="~/js/Delivery/DeliveryShowCart.js"></script>*@
   